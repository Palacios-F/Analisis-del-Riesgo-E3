---
title: "Proyecto Analisis del Riesgo Entrega 3"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 



```{r, echo = FALSE, message = FALSE}
library(quantmod)
library(PerformanceAnalytics)
library(tidyverse)
library(moments)
library(lubridate)
```

```{r}
options("getSymbols.warning4.0"=FALSE)
options("getSymbols.yahoo.warning"=FALSE)
# Descarga de los datos historicos de los últimos cinco años


datos=new.env()
getSymbols("BOLSAA.MX", from = '2008-06-13',
           to = "2022-02-11",warnings = FALSE,
           auto.assign = TRUE)
```
Para el caso de estudio se deberá estimar el rendimiento y la volatilidad (diaria y anualizada) por año (desde el primer año de cotización registrado).


```{r}

print(BOLSAA.MX)
```
```{r}
pricebolsa=BOLSAA.MX$BOLSAA.MX.Close
returnn=Return.calculate(pricebolsa)
print(returnn)
```

```{r}
returnn%>%
  ggplot(aes(Index,BOLSAA.MX.Close))+
  theme_get()+
  geom_line(fill="red")+
labs(title="Rendimientos Diarios del Activo BOLSAA.MX")
```
```{r}
lista <- lapply("BOLSAA.MX", function(x) Cl(get(x)))
precio <- (do.call(merge,lista))
Rend <- na.omit(diff(log(na.omit(precio))))
hist(Rend, n = 100, main = paste("Histograma de" ,"BOLSAA.MX"),col = "#05529B")
chart.Histogram(Rend)
```

```{r}
hist(precio,n=100)
```
```{r}
mean(Rend)
```
```{r}
names(precio) <- c("precio")
names(Rend) <- c("rendimiento")
Anio <- year(Rend)
Est_Prin <- Rend %>%
  as_tibble() %>% 
  mutate(year = Anio) %>% 
  group_by(year) %>% 
  summarise(Rendiario = mean(rendimiento),
            RenAnual = mean(rendimiento)*252,
            Voldiaria = sd(rendimiento),
            VolAnual = sd(rendimiento)*sqrt(252))
```
```{r}
Ren_diario_todo <- mean(Rend)
Vol_diaria_todo <- sd(Rend)
Ren_diario_todo
Vol_diaria_todo
```

#Normalidad del rendimiento
```{r}
Rend %>%
  as_tibble() %>% 
  ggplot(aes(x=rendimiento))+
  geom_histogram(aes(y = ..density..),bins = 100, fill = "#0A7E53", alpha = 0.5)+
  geom_density(aes(x = rendimiento, col = "Densidad empirica"), color =  "#0A7E53")+
  stat_function(fun = dnorm, args = list(mean =Ren_diario_todo, sd = Vol_diaria_todo), aes(col = "Densidad normal"))
```
```{r}
jarque.test(as.numeric(Rend))
```
```{r}
kurtosis(Rend)
skewness(Rend)
```

